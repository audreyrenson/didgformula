<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Audrey Renson" />


<title>Difference-in-differences g-formula with survival outcomes</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Difference-in-differences g-formula with survival outcomes</h1>
<h4 class="author">Audrey Renson</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(didgformula)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">set.seed</span>(<span class="dv">777</span>)</span></code></pre></div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Suppose we observe <span class="math inline">\(N\)</span> iid copies of <span class="math inline">\((L_t, A_t, Y_t)\)</span> over periods <span class="math inline">\(t=0,1,...,T\)</span>, where <span class="math inline">\(A_t\)</span> is a binary (time-varying) treatment, <span class="math inline">\(L_t\)</span> is a binary (time-varying) covariate, and now (in contrast to the ‘introduction’ vignette), <span class="math inline">\(Y_t\)</span> is a binary indicator of the first occurence of some event (e.g., mortality). We can also define the variable <span class="math inline">\(T\in\{0,1,...\}\)</span> as the discrete time-to-event such that <span class="math inline">\(Y_t = I(T=t)\)</span>, where <span class="math inline">\(I(.)\)</span> is the indicator function. So far we do not deal with censoring (coming soon).</p>
<p>We again denote potential outcomes <span class="math inline">\(Y_t(\bar a)\)</span>, as the outcome that would have occurred at time <span class="math inline">\(t\)</span> had treatment history <span class="math inline">\(\bar a\)</span> been received. Say we with to estimate the quantity</p>
<p><span class="math display">\[
E[Y_t(\bar a)] = P(T(\bar a)=t)
\]</span></p>
<p>I.e., the probability of experiencing the first event at time <span class="math inline">\(t\)</span> if (possibly counter to fact) the treatment history <span class="math inline">\(\bar a\)</span> had been received. Say we are willing to make the following assumptions:</p>
<ol style="list-style-type: decimal">
<li><p>SUTVA <span class="math display">\[
\bar A = \bar a \implies Y_t(\bar a) = Y_t
\]</span></p></li>
<li><p>Positivity <span class="math display">\[
P(A_t=a_t|\bar L_t=\bar l_t, \bar A_{t-1}=\bar a_{t-1}) &gt; 0
\]</span> if <span class="math inline">\(P(\bar L_t=\bar l_t, \bar A_{t-1}=\bar a_{t-1})&gt;0\)</span>.</p></li>
<li><p>Generalized parallel trends</p></li>
</ol>
<p>For some strictly monotonic <span class="math inline">\(g(.)\)</span>,</p>
<p><span class="math display">\[
g\bigg(E[Y_t(\bar a)|\bar A_{k-1}=\bar a_{k-1}, \bar L_k]\bigg) - g\bigg(E[Y_{t-1}(\bar a)|\bar A_{k-1}=\bar a_{k-1}, \bar L_k]\bigg)
\]</span> <span class="math display">\[
=g\bigg(E[Y_t(\bar a)|\bar A_k=\bar a_k, \bar L_k]\bigg) - g\bigg(E[Y_{t-1}(\bar a)|\bar A_k=\bar a_k, \bar L_k]\bigg)
\]</span> for <span class="math inline">\(k\in\{0,...,t\}\)</span>, and <span class="math inline">\(t \in \{0,1,..., T\}\)</span>. For example, <span class="math inline">\(g(.)\)</span> might be the logit function (<span class="math inline">\(g(x)=\log(x/[1-x]))\)</span>. We typically will want to consider functions other than identity because <span class="math inline">\(E[Y_t|.]\)</span> is restricted to lie in <span class="math inline">\((0,1)\)</span>.</p>
<ol start="4" style="list-style-type: decimal">
<li>Pre-identification <span class="math display">\[
P(A_0=a_0)=1
\]</span></li>
</ol>
<p>Under assumptions 1-4 with <span class="math inline">\(g(.)\)</span> the logit or cloglog (<span class="math inline">\(g(x)=\log\{-\log[1-x]\}\)</span>), the quantity of interest is identified as:</p>
<p><span class="math display">\[
g(E[Y_t(\bar{a})]) =  g\{E[Y_0]\} 
+ \sum_{s=1}^{t}\int \bigg(  
g\{E[Y_s|\bar{L}_s,\bar{A}_s=\bar{a}_s]\}-  g\{E[Y_{s-1}|\bar{L}_s,\bar{A}_s=\bar{a}_s]\}
\bigg) \prod_{m=0}^{s} dF_{L_m|\bar{L}_{m-1}, \bar{A}_{m-1}}(l_m|\bar{l}_{m-1}, \bar{a}_{m-1})
\]</span> I.e., the difference in differences g-formula under generalized parallel trends. Since estimation of <span class="math inline">\(g\{E[Y_0]\}\)</span> is trivial, we focus on estimating the summand for <span class="math inline">\(s=1,...,t\)</span>. We can estimate this population quantity using inverse weighting, iterated conditional outcome modeling, or by modeling the outcome and covariates. Each of these approaches is implemented in <code>didgformula</code>, by default targeting the summand: <span class="math display">\[
\int_{\bar l} \bigg(  
g\{E[Y_s|\bar{L}_s,\bar{A}_s=\bar{a}_s]\}-  g\{E[Y_{s-1}|\bar{L}_s,\bar{A}_s=\bar{a}_s]\}
\bigg) \prod_{m=0}^{s} dF_{L_m|\bar{L}_{m-1}, \bar{A}_{m-1}}(l_m|\bar{l}_{m-1}, \bar{a}_{m-1})
\]</span></p>
</div>
<div id="simulating-survival-data-under-generalized-parallel-trends" class="section level2">
<h2>Simulating survival data under generalized parallel trends</h2>
<p><code>didgformula</code> contains functionality for simulating survival data under generalized parallel trends on the logit scale. The default setup has one unmeasured baseline covariate, <span class="math inline">\(U_0\)</span>, time-varying binary covariates <span class="math inline">\(L_t\)</span>, binary treatments <span class="math inline">\(A_t\)</span>, and binary outcomes <span class="math inline">\(Y_t\)</span> that can equal 1 for only one <span class="math inline">\(t\)</span> for each participant, observed over periods <span class="math inline">\(t=0,1,...,T\)</span>. First we select parameters for the data-generating models, which are generated from a normal distribution by default (with the exception of <span class="math inline">\(U_0\)</span> which always has prevalence <span class="math inline">\(0.5\)</span>). For now the parameters are packaged as a list of matrices with <span class="math inline">\(T+1\)</span> rows and the same number of columns as coefficients in the data-generating models. We specify the argument <code>range_ymeans=qlogis(c(0.01, 0.05)</code> to keep the mean of each <span class="math inline">\(Y_t\)</span> within a range that keeps <span class="math inline">\(F_T(t)\leq 1\)</span> for all <span class="math inline">\(t\)</span>. This fact is checked using <code>check_CDF=TRUE</code> - a warning will be thrown if the implied CDF is ever greater than <span class="math inline">\(1\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>N_obs =<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>time_periods =<span class="st"> </span><span class="dv">10</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>parameters =<span class="st"> </span><span class="kw">generate_parameters</span>(<span class="dt">Tt=</span>time_periods, <span class="dt">range_ymeans =</span> <span class="kw">qlogis</span>(<span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>)), <span class="dt">check_CDF=</span><span class="ot">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>parameters</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; $U</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; $L</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;        intercept       At-1</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;  [1,] -1.1736397  0.2108325</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;  [2,] -1.2016993 -0.1761861</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;  [3,] -0.2841499  0.1932487</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  [4,] -1.0591882  0.6622990</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt;  [5,] -0.7616362  0.3944680</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt;  [6,] -0.6471139  0.3929216</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt;  [7,] -1.3077030  0.0911735</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt;  [8,] -0.9678025  0.3342446</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt;  [9,] -0.6550381  0.3001637</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; [10,] -0.5127867 -0.2061272</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; [11,] -0.9609198  0.2455504</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; </span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; $A</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt;       intercept          U0          Lt</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt;  [1,] -3.685026 -0.04294060  0.32557805</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt;  [2,] -2.621794  0.50463058  0.35951615</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt;  [3,] -3.769847 -0.04719657  0.05401914</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt;  [4,] -2.539522  0.53317062  0.03285979</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt;  [5,] -2.960817  0.09928313  0.13137607</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt;  [6,] -2.884232  0.08430426  0.49680140</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt;  [7,] -3.597914  0.25435369  0.50656218</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt;  [8,] -2.452261  0.13974347 -0.04202101</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt;  [9,] -2.681989  0.11682414  0.66604146</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">#&gt; [10,] -3.192525  0.05371911  0.18602862</span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">#&gt; [11,] -2.541342  0.03312618  0.25025718</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">#&gt; </span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">#&gt; $Y</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">#&gt;       intercept  U0         Lt          At LtU0</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt;  [1,] -3.232050 0.1 0.23013467  0.37168925    0</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt;  [2,] -4.125171 0.1 0.00588917 -0.08376248    0</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt;  [3,] -3.579765 0.1 0.29732210 -0.14754722    0</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt;  [4,] -3.160586 0.1 0.36596563  0.08610528    0</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt;  [5,] -3.817472 0.1 0.20152397  0.35364166    0</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co">#&gt;  [6,] -4.799325 0.1 0.40783573  0.02013073    0</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">#&gt;  [7,] -4.288708 0.1 0.19461637  0.45167061    0</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">#&gt;  [8,] -4.608719 0.1 0.17261886  0.03766493    0</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">#&gt;  [9,] -3.748720 0.1 0.21185844  0.11173676    0</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="co">#&gt; [10,] -3.574794 0.1 0.02631759  0.35453614    0</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="co">#&gt; [11,] -4.496088 0.1 0.01376149  0.11019828    0</span></span></code></pre></div>
<p>For <code>generate_data()</code>, we specify the argument <code>ylink=&quot;rbinom_logit_hazard&quot;</code> to specify that the parameters are for a logistic-linear model for <span class="math inline">\(Y_t=I(T=t)\)</span>, and the ‘hazard’ piece indicates that the event happens only once. (The parameters are for the mass function, but internally the data are generated according to the implied hazard function.)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>df_survival =<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">N=</span>N_obs, <span class="dt">Tt=</span>time_periods, <span class="dt">Beta=</span>parameters, <span class="dt">ylink=</span><span class="st">&quot;rbinom_logit_hazard&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">head</span>(df_survival)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt;   uid U0 L0 A0 L1 A1 L2 A2 L3 A3 L4 A4 L5 A5 L6 A6 L7 A7 L8 A8 L9 A9 L10 A10 Y0 Y1 Y2 Y3 Y4 Y5 Y6 Y7 Y8 Y9 Y10</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; 1   1  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  1  0  0  0  0  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; 2   2  1  1  0  1  0  1  0  0  0  1  0  0  0  0  0  0  0  1  0  0  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; 3   3  0  0  0  1  0  0  0  0  1  0  1  0  1  0  1  0  1  0  1  1  1   0   1  0  0  0  0  0  0  1  0  0  0   0</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; 4   4  1  1  0  0  1  0  1  0  1  0  1  0  1  1  1  0  1  0  1  0  1   1   1  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; 5   5  1  1  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  1  0  1  0   1   0  0  1  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; 6   6  1  1  0  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0  0  0  0  0  0  0  0  0  1  0   0</span></span></code></pre></div>
<p>We will also store potential outcomes to later estimate the ‘true’ values of the parameters.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>df_survival_po =<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">N=</span>N_obs<span class="op">*</span><span class="dv">10</span>, <span class="dt">Tt=</span>time_periods, <span class="dt">Beta=</span>parameters, <span class="dt">ylink=</span><span class="st">&quot;rbinom_logit_hazard&quot;</span>, <span class="dt">potential_outcomes =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">head</span>(df_survival_po)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt;   uid U0 L0 A0 L1 A1 L2 A2 L3 A3 L4 A4 L5 A5 L6 A6 L7 A7 L8 A8 L9 A9 L10 A10 Y0 Y1 Y2 Y3 Y4 Y5 Y6 Y7 Y8 Y9 Y10</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; 1   1  1  0  0  1  0  0  0  1  0  0  0  0  0  1  0  1  0  1  0  1  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; 2   2  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  1  0  0  0  0  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 3   3  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  0   1   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; 4   4  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  1  0  0  0  1  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; 5   5  1  0  0  0  0  1  0  1  0  0  0  0  0  0  0  1  0  0  0  1  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; 6   6  0  0  0  0  0  0  0  1  0  0  0  1  0  1  0  0  0  0  0  0  0   0   0  0  0  0  0  0  0  0  0  0  0   0</span></span></code></pre></div>
<p>The data-generating mechanism used in <code>generate_data(ylink=&quot;rbinom_logit_hazard&quot;)</code> is:</p>
<p><span class="math display">\[ U_0 \sim \text{Bernoulli}(0.5) \]</span> <span class="math display">\[ L_t \sim \text{Bernoulli}(\text{logit}^{-1}[\gamma_{0t} + \gamma_{1t}A_{t-1}]) \]</span> <span class="math display">\[ A_0 = 0\]</span> <span class="math display">\[(A_t | A_{t-1} = 1) = 1\]</span> <span class="math display">\[(A_t | A_{t-1} = 0) \sim \text{Bernoulli}(\text{logit}{-1}[\alpha_{0t} +\alpha_{1t}U_0 + \alpha_{2t}L_t])\]</span> <span class="math display">\[Y_t \sim \text{Bernoulli}(\text{logit}^{-1}[\beta_{0t} + \beta_{1t}A_t + \beta_{2t}L_t + \beta_3U_0 + \beta_4U_0L_t])\]</span> This data-generating mechanism is consistent with with generalized parallel trends with <span class="math inline">\(g(x)=\log(x/[1-x])\)</span>, provable by the fact that <span class="math inline">\(L_t \coprod U_0 |\bar L_{t-1}, \bar A_{t-1}=\bar a_{t-1}\)</span> and <span class="math inline">\(\frac{\partial g(E[Y_t|\bar L_t, \bar A_t=\bar a_t, U_0])}{\partial U_0}=\frac{\partial g( E[Y_{t-1}|\bar L_t, \bar A_t=\bar a_t, U_0])}{\partial U_0}=0.1\)</span>.</p>
<p>We can check whether generalized parallel trends is approximately satisfied using the simulated potential outcomes data. We specify the argument <code>link_fun=qlogis</code> to indicate that we are checking generalized parallel trends on the logit scale. This parameter takes a function as argument and <code>qlogis()</code> is R’s built in logit function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">pt_deviation_histograms</span>(df_survival_po, <span class="dt">Tt=</span>time_periods, <span class="dt">link_fun =</span> qlogis)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; Warning: Removed 5112 rows containing non-finite values (stat_bin).</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The matrix of histograms has <span class="math inline">\(t\)</span> on the x-axis and <span class="math inline">\(k\)</span> on the y-axis, so that the <span class="math inline">\((t, k)\)</span>th cell displays estimates of <span class="math inline">\(E[Y_t(\bar a) - Y_{t-1}(\bar a)|\bar A_{k-1}=\bar a_{k-1}, \bar L_k]=E[Y_t(\bar a) - Y_{t-1}(\bar a)|\bar A_k=\bar a_k, \bar L_k]\)</span> across possible values of <span class="math inline">\(\bar L_k\)</span> (actually, just <span class="math inline">\(L_k\)</span> is sufficient based on the data-generating mechanism). These estimates should look like unbiased estimates of zero (each cell should look like it has mean 0, the red line). With survival data there are often many time periods, so it will typically be difficult to plot paralle trend deviations for all of them. To look at one <span class="math inline">\(k\)</span> at a time:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">pt_deviation_histograms</span>(df_survival_po, <span class="dt">Tt=</span>time_periods, <span class="dt">k=</span><span class="dv">5</span>, <span class="dt">link_fun =</span> qlogis)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; Warning: Removed 245 rows containing non-finite values (stat_bin).</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="estimation" class="section level2">
<h2>Estimation</h2>
<p>Estimation proceeds similarly as with continuous outcomes (see introduction vignette). Only ICE and outcome regression have been derived under generalized parallel trends. Note that the returned values are estimates of <span class="math inline">\(g(E[Y_t(\bar a)]) - g(E[Y_{t-1}(\bar a)])\)</span>, by virtue of specifying <code>inside_family = &#39;binomial&#39;</code>. This is because the logit function is the default link for <code>stats::binomial()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>estimates_ice   =<span class="st"> </span><span class="kw">ice_pipeline</span>(df_survival, <span class="dt">inside_formula_t =</span> <span class="st">&#39;~L{t}&#39;</span>, <span class="dt">inside_formula_tmin1=</span><span class="st">&#39;~L{t}&#39;</span>, <span class="dt">outside_formula =</span> <span class="st">&#39;~L{k}&#39;</span>, <span class="dt">inside_family =</span> <span class="st">&#39;binomial&#39;</span>, <span class="dt">Tt=</span>time_periods)</span>
<span id="cb7-2"><a href="#cb7-2"></a>estimates_or    =<span class="st"> </span><span class="kw">or_pipeline</span>(df_survival, <span class="dt">yt_formula =</span> <span class="st">&#39;~L{t}&#39;</span>, <span class="dt">ytmin1_formula =</span> <span class="st">&#39;~L{t-1}&#39;</span>, <span class="dt">l_formula =</span> <span class="st">&#39;~1&#39;</span>, <span class="dt">y_family =</span> <span class="st">&#39;binomial&#39;</span>, <span class="dt">Tt=</span>time_periods, <span class="dt">nreps=</span>N_obs)</span>
<span id="cb7-3"><a href="#cb7-3"></a>estimates_truth =<span class="st"> </span><span class="kw">estimate_truth</span>(df_survival_po, <span class="dt">Tt=</span>time_periods, <span class="dt">link_fun=</span>qlogis)</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">combine_estimates</span>(<span class="dt">truth=</span>estimates_truth, <span class="dt">ice=</span>estimates_ice, <span class="dt">or=</span>estimates_or, <span class="dt">Tt=</span>time_periods)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt;        t  truth      ice       or</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;    &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;  1     1 -1.01  -0.0290  -0.0291 </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt;  2     2  0.728  0.0144   0.0144 </span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt;  3     3  0.423  0.0190   0.0190 </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;  4     4 -0.732 -0.0244  -0.0244 </span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;  5     5 -0.945 -0.0161  -0.0160 </span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;  6     6  0.429  0.00395  0.00388</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;  7     7 -0.361 -0.00383 -0.00383</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt;  8     8  0.946  0.0174   0.0175 </span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;  9     9  0.147  0.00423  0.00412</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; 10    10 -1.01  -0.0218  -0.0218</span></span></code></pre></div>
<p>To arrive at estimates of <span class="math inline">\(E[Y_t(\bar a)]\)</span>, since <span class="math inline">\(P(A_0=a_0)=1\)</span> by the data-generating mechanism, we have:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>gEY0_truth =<span class="st"> </span><span class="kw">qlogis</span>(<span class="kw">mean</span>(df_survival_po<span class="op">$</span>Y0))</span>
<span id="cb8-2"><a href="#cb8-2"></a>gEY0_data  =<span class="st"> </span><span class="kw">qlogis</span>(<span class="kw">mean</span>(df_survival<span class="op">$</span>Y0))</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>gEYat_truth =<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">t=</span><span class="dv">1</span><span class="op">:</span>time_periods, <span class="dt">estimate =</span> <span class="kw">plogis</span>(gEY0_truth <span class="op">+</span><span class="st"> </span><span class="kw">cumsum</span>(estimates_truth<span class="op">$</span>estimate)))</span>
<span id="cb8-5"><a href="#cb8-5"></a>gEYat_ice =<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">t=</span><span class="dv">1</span><span class="op">:</span>time_periods, <span class="dt">estimate =</span>  <span class="kw">plogis</span>(gEY0_data <span class="op">+</span><span class="st"> </span><span class="kw">cumsum</span>(estimates_ice<span class="op">$</span>estimate)))</span>
<span id="cb8-6"><a href="#cb8-6"></a>gEYat_or =<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">t=</span><span class="dv">1</span><span class="op">:</span>time_periods, <span class="dt">estimate =</span>  <span class="kw">plogis</span>(gEY0_data <span class="op">+</span><span class="st"> </span><span class="kw">cumsum</span>(estimates_or<span class="op">$</span>estimate)))</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>combined =<span class="st"> </span><span class="kw">combine_estimates</span>(gEYat_truth, <span class="dt">ice=</span>gEYat_ice, <span class="dt">or=</span>gEYat_or, <span class="dt">Tt=</span>time_periods)</span>
<span id="cb8-9"><a href="#cb8-9"></a>combined</span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;        t   truth    ice     or</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;  1     1 0.0166  0.0452 0.0452</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;  2     2 0.0338  0.0459 0.0459</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;  3     3 0.0507  0.0467 0.0467</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;  4     4 0.0250  0.0456 0.0456</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;  5     5 0.00988 0.0449 0.0449</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt;  6     6 0.0151  0.0451 0.0451</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt;  7     7 0.0106  0.0449 0.0449</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt;  8     8 0.0268  0.0457 0.0457</span></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt;  9     9 0.0309  0.0459 0.0459</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt; 10    10 0.0115  0.0449 0.0449</span></span></code></pre></div>
<p>If we are interested in risk (<span class="math inline">\(P(T(\bar a) \leq t)\)</span>), we can take the cumulative sum:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>combined <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(dplyr<span class="op">::</span><span class="kw">across</span>(truth<span class="op">:</span>or, cumsum))</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;        t  truth    ice     or</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;    &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;  1     1 0.0166 0.0452 0.0452</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt;  2     2 0.0504 0.0911 0.0911</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;  3     3 0.101  0.138  0.138 </span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt;  4     4 0.126  0.183  0.183 </span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;  5     5 0.136  0.228  0.228 </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;  6     6 0.151  0.273  0.273 </span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;  7     7 0.162  0.318  0.318 </span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;  8     8 0.188  0.364  0.364 </span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;  9     9 0.219  0.410  0.410 </span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; 10    10 0.231  0.455  0.455</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
